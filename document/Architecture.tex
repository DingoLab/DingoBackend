\documentclass[UTF8]{book}
\def\ARCHITECTURETEX{\relax}
\input{Preamble.tex}

%后端宏观架构
\part{后端宏观架构}

此部分将包含处理负载均衡的大致方法、弹性计算的解决方案、后端API与服务程序分割的
策略，其中会有另一个文档详细描述如何测试 Yesod 框架的负载特性。
此外还将会有对整个宏观设计一个小的对可行性的讨论。


\chapter{负载均衡}
\section{预期目标}
Dingo 的后端的使用人数并不会多，而且这就是个大作业。然而 按着刘西洋教授的号召：代入感，我还是计划提前预留好
应对大量负载的东西。而且放一颗卫星，希望所能完成的负载量能超过一千万。但是从实际来讲，可能一千万的负载量在
绝大多数的情况下是不需要的，甚至有些时候的负载会长时间达到个位数级别。所以，整个负载是基于弹性计算的。
同时在阅读到 灵雀云微信公众号推的一篇文章，有关于微服务的。大致有了这样整个负载的解决方案。
\section{硬件负载部分}
我需要看门见山的点出，整个负载均衡的处理办法不包括硬件级别的负载均衡，而之所以在这样一部分点出来，是因为要点出为何不使用硬件均衡。

不使用硬件均衡的原因很简单，那就是由于会使用到弹性计算，所以可能、应该用不上，也没有办法去用。
整个负载计划是使用负载均衡软件与、服务注册与Docker。而整个后端是直接使用 容器，而非直接使用物理或虚拟机或传统意义上的云计算。
\section{负载的组成}
负载的组成有四大部分组成：负载均衡、服务注册、微服务、DockerShip。

负载均衡使用的是多层 Nginx 进行负载均衡。使用 Docker 容器中运行的 Nginx 。而假设对一个标准的容器，我们定义一个标准单位。
定义标准 CPU 单位计算能力$c$，并使得该单位为离散的（即存在两个数值，其之间不存在任何合法数值）。设定函数
$f_{Nginx}(c,m)$ 表示对一个 Docker容器“运行” Nginx 镜像，其中的容器所分配的 cpu 资源为 c，内存配大小为 m，
并假定其他参数不影响。这个 Docker 容器，$f_{Nginx}$所表示的则是该情况之下 Nginx 的最大负载量。并设 $d_{Nginx}(c,m)$ 表示该情况下的延迟。

